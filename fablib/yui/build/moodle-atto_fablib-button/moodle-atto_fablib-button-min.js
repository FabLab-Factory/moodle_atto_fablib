YUI.add("moodle-atto_fablib-button",function(T,e){var S={CLOSE:"atto_fablib_close",RESPONSIVE:"img-responsive",INPUTALIGNMENT:"atto_fablib_bannerimage_alignment",INPUTALT:"atto_fablib_bannerimage_altentry",INPUTHEIGHT:"atto_fablib_bannerimage_heightentry",INPUTSUBMIT:"atto_fablib_bannerimage_urlentrysubmit",INPUTURL:"atto_fablib_bannerimage_urlentry",INPUTSIZE:"atto_fablib_bannerimage_size",INPUTWIDTH:"atto_fablib_bannerimage_widthentry",IMAGEALTWARNING:"atto_fablib_bannerimage_altwarning",IMAGEBROWSER:"atto_fablib_bannerimage_openimagebrowser",IMAGEPRESENTATION:"atto_fablib_bannerimage_presentation",INPUTCONSTRAIN:"atto_fablib_bannerimage_constrain",INPUTCUSTOMSTYLE:"atto_fablib_bannerimage_customstyle",IMAGEPREVIEW:"atto_fablib_bannerimage_preview",IMAGEPREVIEWBOX:"atto_fablib_bannerimage_preview_box",ALIGNSETTINGS:"atto_fablib_bannerimage_button"},t={INPUTURL:"."+S.INPUTURL},o=[{name:"verticalAlign",str:"alignment_top",value:"text-top",margin:"0 0.5em"}],u="atto_fablib",s=[{index:"0",category:"machines",name:"machine1"},{index:"1",category:"machines",name:"machine2"},{index:"2",category:"machines",name:"machine3"},{index:"3",category:"machines",name:"machine4"},{index:"4",category:"machines",name:"machine5"},{index:"5",category:"machines",name:"machine6"},{index:"6",category:"machines",name:"machine7"},{index:"7",category:"machines",name:"machine8"},{index:"8",category:"machines",name:"machine9"}],C=[{index:"0",category:"sdg",name:"sdg1",icon:"sdg1"},{index:"1",category:"sdg",name:"sdg2",icon:"sdg2"},{index:"2",category:"sdg",name:"sdg3",icon:"sdg3"},{index:"3",category:"sdg",name:"sdg4",icon:"sdg4"},{index:"4",category:"sdg",name:"sdg5",icon:"sdg5"},{index:"5",category:"sdg",name:"sdg6",icon:"sdg6"},{index:"6",category:"sdg",name:"sdg7",icon:"sdg7"},{index:"7",category:"sdg",name:"sdg8",icon:"sdg8"},{index:"8",category:"sdg",name:"sdg9",icon:"sdg9"},{index:"9",category:"sdg",name:"sdg10",icon:"sdg10"},{index:"10",category:"sdg",name:"sdg11",icon:"sdg11"},{index:"11",category:"sdg",name:"sdg12",icon:"sdg12"},{index:"12",category:"sdg",name:"sdg13",icon:"sdg13"},{index:"13",category:"sdg",name:"sdg14",icon:"sdg14"},{index:"14",category:"sdg",name:"sdg15",icon:"sdg15"},{index:"15",category:"sdg",name:"sdg16",icon:"sdg16"},{index:"16",category:"sdg",name:"sdg17",icon:"sdg17"}],I=[{index:"0",category:"century",name:"literacy",icon:"literacy"},{index:"1",category:"century",name:"scientific_literacy",icon:"scientific_literacy"},{index:"2",category:"century",name:"ict_literacy",icon:"ict_literacy"},{index:"3",category:"century",name:"financial_literacy",icon:"financial_literacy"},{index:"4",category:"century",name:"numeracy",icon:"numeracy"},{index:"5",category:"century",name:"civic_literacy",icon:"civic_literacy"},{index:"6",category:"century",name:"critical_thinking",icon:"critical_thinking"},{index:"7",category:"century",name:"communication",icon:"communication"},{index:"8",category:"century",name:"collaboration",icon:"collaboration"},{index:"9",category:"century",name:"creativity",icon:"creativity"},{index:"10",category:"century",name:"initiative",icon:"initiative"},{index:"11",category:"century",name:"adaptability",icon:"adaptability"},{index:"12",category:"century",name:"curiosity",icon:"curiosity"},{index:"13",category:"century",name:"leadership",icon:"leadership"},{index:"14",category:"century",name:"social_awareness",icon:"social_awareness"}],w=[{index:"0",category:"ct",name:"abstraction",icon:"abstraction"},{index:"1",category:"ct",name:"generalization",icon:"generalization"},{index:"2",category:"ct",name:"decomposition",icon:"decomposition"},{index:"3",category:"ct",name:"algorithmic_thinking",icon:"algorithmic_thinking"},{index:"4",category:"ct",name:"evaluation",icon:"evaluation"}],d=[{index:"0",category:"digital_making",name:"digital_making1",creator_help:"digital_making1_creator_help",builder_help:"digital_making1_builder_help",developer_help:"digital_making1_developer_help",maker_help:"digital_making1_maker_help"},{index:"1",category:"digital_making",name:"digital_making2",creator_help:"digital_making2_creator_help",builder_help:"digital_making2_builder_help",developer_help:"digital_making2_developer_help",maker_help:"digital_making2_maker_help"},{index:"2",category:"digital_making",name:"digital_making3",creator_help:"digital_making3_creator_help",builder_help:"digital_making3_builder_help",developer_help:"digital_making3_developer_help",maker_help:"digital_making3_maker_help"},{index:"3",category:"digital_making",name:"digital_making4",creator_help:"digital_making4_creator_help",builder_help:"digital_making4_builder_help",developer_help:"digital_making4_developer_help",maker_help:"digital_making4_maker_help"},{index:"4",category:"digital_making",name:"digital_making5",creator_help:"digital_making5_creator_help",builder_help:"digital_making5_builder_help",developer_help:"digital_making5_developer_help",maker_help:"digital_making5_maker_help"}],g=[{index:"0",category:"digital_making_levels",name:"digital_making_creator",icon:"creator_icon"},{index:"1",category:"digital_making_levels",name:"digital_making_builder",icon:"builder_icon"},{index:"2",category:"digital_making_levels",name:"digital_making_developer",icon:"developer_icon"},{index:"3",category:"digital_making_levels",name:"digital_making_maker",icon:"maker_icon"}],i=[{code:"EN",name:"english"},{code:"NL",name:"dutch"}],n='<form class="atto_attoform"><div class="container mt-3"><div class="row"><div class="col-4 mb-1"><label for="language">'+M.util.get_string("language",u
)+'</label></div><div class="col-8 mb-1"><select name="language" id="language">{{#each LANGUAGES}}<option value="{{code}}">{{get_string name "atto_fablib"}}</option>{{/each}}</select></div></div><div class="row"><div class="col-12 accordion" id="bannerimageAccordion"><div class="card"><div class="card-header" id="headingOne"><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">Banner image</button></h5></div><div id="collapseOne" class="collapse show" aria-labelledby="headingOne" data-parent="#bannerimageAccordion"><div class="card-body"><div clas="container"><div class="row">{{#if showFilepicker}}<div class="col-4 mb-1"><label for="{{elementid}}_{{CSS.INPUTURL}}">{{get_string "enterurl" component}}</label></div><div class="col-4 mb-1"><div class="input-group input-append "><input class="form-control {{CSS.INPUTURL}}" type="url" id="{{elementid}}_{{CSS.INPUTURL}}" size="32"/></div></div><div class="col-4 mb-1"><span class="input-group-append"><button class="btn btn-secondary {{CSS.IMAGEBROWSER}}" type="button">{{get_string "browserepositories" component}}</button></span></div>{{else}}<div class="col-4 mb-1"><label for="{{elementid}}_{{CSS.INPUTURL}}">{{get_string "enterurl" component}}</label></div><div class="col-8 mb-1"><input class="form-control fullwidth {{CSS.INPUTURL}}" type="url" id="{{elementid}}_{{CSS.INPUTURL}}" size="32"/></div>{{/if}}</div><div class="row"><div class="col-4 mb-1"><label class="for="{{elementid}}_{{CSS.INPUTALIGNMENT}}">{{get_string "alignment" component}}</label></div><div class="col-8 mb-1"><select class="custom-select {{CSS.INPUTALIGNMENT}}" id="{{elementid}}_{{CSS.INPUTALIGNMENT}}">{{#each alignments}}<option value="{{value}}">{{get_string str ../component}}</option>{{/each}}</select></div><input type="hidden" class="{{CSS.INPUTCUSTOMSTYLE}}"/></div class="row"><div class="row"><div class="col-12 mdl-align"><div class="{{CSS.IMAGEPREVIEWBOX}}"><img src="#" class="{{CSS.IMAGEPREVIEW}}" alt="" style="display: none;"/></div></div></div></div></div></div></div></div></div><div class="row"><div class="col-6"><div class="accordion" id="leftAccordion"><div class="card"><div class="card-header" id="leftAccordionHeadingOne"><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#leftAccordionCollapseOne" aria-expanded="true" aria-controls="leftAccordionCollapseOne">{{get_string "duration" component}}</button></h5></div><div id="leftAccordionCollapseOne" class="collapse show" aria-labelledby="leftAccordionHeadingOne" data-parent="#leftAccordion"><div class="card-body"><div clas="container"><div class="row"><div class="col-3 mb-1"><label for="duration">{{get_string "select" component}}: </label></div><div class="col-9 mb-1"><select name="duration" id="duration"><option value="duration1">{{get_string "duration1" component}}</option><option value="duration2">{{get_string "duration2" component}}</option><option value="duration3">{{get_string "duration3" component}}</option><option value="duration4">{{get_string "duration4" component}}</option><option value="duration5">{{get_string "duration5" component}}</option><option value="duration6">{{get_string "duration6" component}}</option><option value="duration7">{{get_string "duration7" component}}</option></select></div></div></div></div></div></div><div class="card"><div class="card-header" id="leftAccordionHeadingTwo"><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#leftAccordionCollapseTwo" aria-expanded="true" aria-controls="leftAccordionCollapseTwo">{{get_string "difficulty" component}}</button></h5></div><div id="leftAccordionCollapseTwo" class="collapse show" aria-labelledby="leftAccordionHeadingTwo" data-parent="#leftAccordion"><div class="card-body"><div clas="container"><div class="row"><div class="col-3 mb-1"><label for="difficulty">Select: </label></div><div class="col-9 mb-1"><select name="diffuculty" id="difficulty"><option value="difficulty1">{{get_string "difficulty1" component}}</option><option value="difficulty2">{{get_string "difficulty2" component}}</option><option value="difficulty3">{{get_string "difficulty3" component}}</option></select></div></div></div></div></div></div><div class="card"><div class="card-header" id="leftAccordionHeadingThree"><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#leftAccordionCollapseThree" aria-expanded="true" aria-controls="leftAccordionCollapseThree">{{get_string "machines" component}}</button></h5></div><div id="leftAccordionCollapseThree" class="collapse show" aria-labelledby="leftAccordionHeadingThree" data-parent="#leftAccordion"><div class="card-body"><div clas="container"><div class="row"><p>{{get_string "check_machines" component}}</p></div><fieldset>{{#each MACHINES}}<div class="row"><div class="col-1"><input type="checkbox" id="checkbox{{category}}{{index}}" name="{{category}}" value="{{name}}"></div><div class="col-10"><label for="checkbox{{category}}{{index}}">{{get_string name "atto_fablib"}}</label></div></div>{{/each}}</fieldset></div></div></div></div><div class="card"><div class="card-header" id="leftAccordionHeadingFour"><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#leftAccordionCollapseFour" aria-expanded="true" aria-controls="leftAccordionCollapseFour">{{get_string "materials" component}}</button></h5></div><div id="leftAccordionCollapseFour" class="collapse show" aria-labelledby="leftAccordionHeadingFour" data-parent="#leftAccordion"><div class="card-body"><div clas="container"><div class="row"><div class="col-12 form-group"><label for="materialsTextArea">{{get_string "help_materials" component}}</label><label><i>{{get_string "example_materials" component}}</i></label><textarea class="form-control" id="materialsTextArea" rows="3"></textarea></div></div></div></div></div></div><div class="card"><div class="card-header" id="leftAccordionHeadingFive"><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#leftAccordionCollapseFive" aria-expanded="true" aria-controls="leftAccordionCollapseFive">{{get_string "files" component}}</button></h5></div><div id="leftAccordionCollapseFive" class="collapse show" aria-labelledby="leftAccordionHeadingFive" data-parent="#leftAccordion"><div class="card-body"><div clas="container"><div class="row"><div class="col-12 form-group"><label for="filesTextArea">{{get_string "help_files" component}}</label><label><i>{{get_string "example_files" component}}</i></label><textarea class="form-control" id="filesTextArea" rows="3"></textarea></div></div></div></div></div></div><div class="card"><div class="card-header" id="leftAccordionHeadingSix"><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#leftAccordionCollapseSix" aria-expanded="true" aria-controls="leftAccordionCollapseSix">{{get_string "safety" component}}</button></h5></div><div id="leftAccordionCollapseSix" class="collapse show" aria-labelledby="leftAccordionHeadingSix" data-parent="#leftAccordion"><div class="card-body"><div clas="container"><div class="row"><div class="col-12 form-group"><label for="safetyTextArea" id="safetyHelpBlock">{{get_string "help_safety" component}}</label><label id="safetyExampleBlock"><i>{{get_string "example_safety" component}}</i></label><textarea class="form-control" id="safetyTextArea" rows="3"></textarea></div></div></div></div></div></div><div class="card"><div class="card-header" id="leftAccordionHeadingSeven"><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#leftAccordionCollapseSeven" aria-expanded="true" aria-controls="leftAccordionCollapseSeven">Credits</button></h5></div><div id="leftAccordionCollapseSeven" class="collapse show" aria-labelledby="leftAccordionHeadingSeven" data-parent="#leftAccordion"><div class="card-body"><div clas="container"><div class="row"><div class="col-12 form-group"><label for="creditsTextArea" id="creditsHelpBlock">{{get_string "help_credits" component}}</label><label id="creditsExampleBlock"><i>{{get_string "example_credits" component}}</i></label><textarea class="form-control" id="creditsTextArea" rows="3"></textarea></div></div></div></div></div></div></div></div><div class="col-6"><div class="accordion" id="rightAccordion"><div class="card"><div class="card-header" id="rightAccordionHeadingOne"><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#rightAccordionCollapseOne" aria-expanded="true" aria-controls="rightAccordionCollapseOne">{{get_string "introduction" component}}</button></h5></div><div id="rightAccordionCollapseOne" class="collapse show" aria-labelledby="rightAccordionHeadingOne" data-parent="#rightAccordion"><div class="card-body"><div clas="container"><div class="row"><div class="col-12 form-group"><label for="introductionTextArea" id="introductionHelpBlock">{{get_string "help_introduction" component}}</label><textarea class="form-control" id="introductionTextArea" rows="3"></textarea></div></div></div></div></div></div><div class="card"><div class="card-header" id="rightAccordionHeadingTwo"><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#rightAccordionCollapseTwo" aria-expanded="true" aria-controls="rightAccordionCollapseTwo">{{get_string "sdg" component}}</button></h5></div><div id="rightAccordionCollapseTwo" class="collapse show" aria-labelledby="rightAccordionHeadingTwo" data-parent="#rightAccordion"><div class="card-body"><div clas="container"><label>{{get_string "check_sdg" component}}</label><fieldset>{{#each SDG}}<div class="row"><div class="col-1"><input data-category="icon" type="checkbox" id="checkbox{{category}}{{index}}" name="{{category}}" value="{{name}}"></div><div class="col-10"><label for="checkbox{{category}}{{index}}">{{get_string name "atto_fablib"}}</label></div></div>{{/each}}</fieldset></div></div></div></div><div class="card"><div class="card-header" id="rightAccordionHeadingThree"><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#rightAccordionCollapseThree" aria-expanded="true" aria-controls="rightAccordionCollapseThree">{{get_string "century" component}}</button></h5></div><div id="rightAccordionCollapseThree" class="collapse show" aria-labelledby="rightAccordionHeadingThree" data-parent="#rightAccordion"><div class="card-body"><div clas="container"><label>{{get_string "check_century" component}}</label><fieldset>{{#each CENTURY}}<div class="row"><div class="col-1"><input data-category="icon" type="checkbox" id="checkbox{{category}}{{index}}" name="{{category}}" value="{{name}}"></div><div class="col-10"><label for="checkbox{{category}}{{index}}">{{get_string name "atto_fablib"}}</label></div></div>{{/each}}</fieldset></div></div></div></div><div class="card"><div class="card-header" id="rightAccordionHeadingFour"><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#rightAccordionCollapseFour" aria-expanded="true" aria-controls="rightAccordionCollapseFour">Computational Thinking</button></h5></div><div id="rightAccordionCollapseFour" class="collapse show" aria-labelledby="rightAccordionHeadingFour" data-parent="#rightAccordion"><div class="card-body"><div clas="container"><label>{{get_string "check_computational_thinking" component}}</label><fieldset>{{#each CT}}<div class="row"><div class="col-1"><input data-category="icon" type="checkbox" id="checkbox{{category}}{{index}}" name="{{category}}" value="{{name}}"></div><div class="col-10"><label for="checkbox{{category}}{{index}}">{{get_string name "atto_fablib"}}</label></div></div>{{/each}}</fieldset></div></div></div></div><div class="card"><div class="card-header" id="rightAccordionHeadingFive"><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#rightAccordionCollapseFive" aria-expanded="true" aria-controls="rightAccordionCollapseFive">{{get_string "digital_making" component}}</button></h5></div><div id="rightAccordionCollapseFive" class="collapse show" aria-labelledby="rightAccordionHeadingFive" data-parent="#rightAccordion"><div class="card-body"><div clas="container"><label>{{get_string "check_digital_making" component}}</label>{{#each DIGITAL_MAKING}}<div class="row"><p>{{get_string name "atto_fablib"}}</p></div><div class="row mb-3"><fieldset><div class="btn-group btn-group-toggle" data-toggle="buttons"><label class="btn btn-secondary active" for="radio{{category}}{{index}}digital_making_levels0" title="{{get_string creator_help "atto_fablib"}}"><input type="radio" data-category="digital_making_button" name="{{name}}" id="radio{{category}}{{index}}digital_making_levels0" value="digital_making_creator" title="{{get_string creator_help "atto_fablib"}}" checked>{{get_string "digital_making_creator" "atto_fablib"}}</label><label class="btn btn-secondary" for="radio{{category}}{{index}}digital_making_levels1" title="{{get_string builder_help "atto_fablib"}}"><input type="radio" data-category="digital_making_button" name="{{name}}" id="radio{{category}}{{index}}digital_making_levels1" value="digital_making_builder" title="{{get_string builder_help "atto_fablib"}}">{{get_string "digital_making_builder" "atto_fablib"}}</label><label class="btn btn-secondary" for="radio{{category}}{{index}}digital_making_levels2" title="{{get_string developer_help "atto_fablib"}}"><input type="radio" data-category="digital_making_button" name="{{name}}" id="radio{{category}}{{index}}digital_making_levels2" value="digital_making_developer" title="{{get_string developer_help "atto_fablib"}}">{{get_string "digital_making_developer" "atto_fablib"}}</label><label class="btn btn-secondary" for="radio{{category}}{{index}}digital_making_levels3" title="{{get_string maker_help "atto_fablib"}}"><input type="radio" data-category="digital_making_button" name="{{name}}" id="radio{{category}}{{index}}digital_making_levels3" value="digital_making_maker" title="{{get_string maker_help "atto_fablib"}}">{{get_string "digital_making_maker" "atto_fablib"}}</label></div></fieldset></div>{{/each}}</div></div></div></div></div></div></div><div class="row"><div class="col-12 mdl-align"><button class="btn btn-secondary {{CSS.INPUTSUBMIT}}" type="submit">{{get_string "insert" component}}</button><button class="btn btn-secondary {{CSS.CLOSE}}" type="button">{{get_string "close" component}}</button></div></div></div></form>'
,m='<img src="{{url}}" alt="Banner image" width="100%"class="fablib_bannerimage mlang_{{lang}}"{{#if id}}id="{{id}}" {{/if}}/><br>',p='<div class="mlang_{{lang}} icon-col col-md-2 col-sm-3 col-xs-6"><img src="{{url}}"  data-category="{{category}}" data-id="{{id}}" class="mlang_{{lang}} img-responsive" width="100%" alt="{{alt}}" title="{{title}}"></div>',_='<div class="container">',h="</div><p><br></p>",v='<div class="row">',b="</div>",c="<ul>",f="</ul><br>",y='<li class="mlang_{{lang}}" data-category="{{category}}" data-id="{{id}}">{{item}}</li>';T.namespace("M.atto_fablib").Button=T.Base.create("button",T.M.editor_atto.EditorPlugin,[],{_currentSelection:null,_selectedImage:null,_attoform:null,_rawImageDimensions:null,_currentLanguageCode:null,_currentLanguageSelector:null,initializer:function(){this.addButton({icon:M.util.image_url("ed/fablib_metadata","atto_fablib"),callback:this._displayDialogue,tags:".contentwrapper",tagMatchRequiresAll:!1}),this.editor.delegate("dblclick",this._displayDialogue,".contentwrapper",this),this.editor.delegate("click",this._handleClick,".contentwrapper",this),this.editor.on("drop",this._handleDragDrop,this),this.editor.on("dragover",function(e){e.preventDefault()},this),this.editor.on("dragenter",function(e){e.preventDefault()},this)},_handleDragDrop:function(e){var t,a,i,n,o,l,r,s,c,d,g=this,p=this.get("host"),_=T.Handlebars.compile(m);if(p.saveSelection(),e=e._event,t=this._attoform.one("#language").get("value"),e.dataTransfer&&e.dataTransfer.files&&e.dataTransfer.files.length&&/^image\//.test(e.dataTransfer.files[0].type)){for(i=(a=p.get("filepickeroptions").image).savepath===undefined?"/":a.savepath,n=new FormData,o=0,l="",r=new XMLHttpRequest,s="",c=Object.keys(a.repositories),e.preventDefault(),e.stopPropagation(),n.append("repo_upload_file",e.dataTransfer.files[0]),n.append("itemid",a.itemid),d=0;d<c.length;d++)if("upload"===a.repositories[c[d]].type){n.append("repo_id",a.repositories[c[d]].id);break}return n.append("env",a.env),n.append("sesskey",M.cfg.sesskey),n.append("client_id",a.client_id),n.append("savepath",i),n.append("ctx_id",a.context.id),o=(new Date).getTime(),l="moodleimage_"+Math.round(1e5*Math.random())+"-"+o,p.focus(),p.restoreSelection(),s=_({url:M.util.image_url("i/loading_small","moodle"),alt:M.util.get_string("uploading",u),id:l,lang:t}),p.insertContentAtFocusPoint(s),g.markUpdated(),r.onreadystatechange=function(){var e,t,a,i,n=g.editor.one("#"+l);if(4===r.readyState)if(200===r.status){if(e=JSON.parse(r.responseText)){if(e.error)return n&&n.remove(!0),new M.core.ajaxException(e);(t=e).event&&"fileexists"===e.event&&(t=e.newfile),a=_({url:t.url,presentation:!0}),i=T.Node.create(a),n?n.replace(i):g.editor.appendChild(i),g.markUpdated()}}else T.use("moodle-core-notification-alert",function(){new M.core.alert({message:M.util.get_string("servererror","moodle")})}),n&&n.remove(!0)},r.open("POST",M.cfg.wwwroot+"/repository/repository_ajax.php?action=upload",!0),r.send(n),!1}},_handleClick:function(e){var t=e.target,a=this.get("host").getSelectionFromNode(t);this.get("host").getSelection()!==a&&this.get("host").setSelection(a)},_displayDialogue:function(){this._currentSelection=this.get("host").getSelection(),!1!==this._currentSelection&&(this._rawImageDimensions=null,this._currentLanguageCode="EN",this._currentLanguageSelector=".mlang_EN",this.getDialogue({headerContent:M.util.get_string("title",u),width:"auto",focusAfterHide:!0,focusOnShowSelector:t.INPUTURL}).set("bodyContent",this._getDialogueContent()).show())},_loadPreviewImage:function(e){var t=new Image,a=this;t.onerror=function(){a._attoform.one("."+S.IMAGEPREVIEW).setStyles({display:"none"}),a.getDialogue().centerDialogue()},t.onload=function(){var e;a._rawImageDimensions={width:this.width,height:this.height},(e=a._attoform.one("."+S.IMAGEPREVIEW)).setAttribute("src",this.src),e.setStyles({display:"inline"}),a.getDialogue().centerDialogue()},t.src=e},_getDialogueContent:function(){var e=T.Handlebars.compile(n),t=this.get("host").canShowFilepicker("image"),a=T.Node.create(e({elementid:this.get("host").get("elementid"),CSS:S,component:u,LANGUAGES:i,MACHINES:s,SDG:C,CENTURY:I,CT:w,DIGITAL_MAKING:d,DIGITAL_MAKING_LEVELS:g,showFilepicker:t,alignments:o}));return this._attoform=a,this._attoform.one("#language").on("change",this._updateFormContent,this),this._applyImageProperties(this._attoform),this._applyFablibProperties(this._attoform),this._attoform.one("."+S.INPUTURL).on("blur",this._urlChanged,this),this._attoform.one("."+S.INPUTURL).on("blur",this._urlChanged,this),this._attoform.one("."+S.INPUTSUBMIT).on("click",this._insertData,this),this._attoform.one("."+S.CLOSE).on("click",this._closeDialogue,this),t&&a.delegate("click",function(e){var t=this._attoform;e.preventDefault(),this.get("host").showFilepicker("image",this._getFilepickerCallback(t),this)},".atto_fablib_bannerimage_openimagebrowser",this),a},_updateFormContent:function(){this._setCurrentLanguage(),this._applyImageProperties(this._attoform),this._applyFablibProperties(this._attoform)},_setCurrentLanguage:function(){this._currentLanguageCode=this._attoform.one("#language").get("value"),this._currentLanguageSelector=".mlang_"+this._currentLanguageCode},_filepickerCallback:function(e){""!==e.url&&(this._attoform.one("."+S.INPUTURL).set("value",e.url),this._loadPreviewImage(e.url))},_getFilepickerCallback:function(a){return function(e){var t;""!==e.url&&(a.one("."+S.INPUTURL).set("value",e.url),(t=new Image).onerror=function(){a.one("."+S.IMAGEPREVIEW).setStyles({display:"none"})},t.onload=function(){var e;(e=a.one("."+S.IMAGEPREVIEW)).setAttribute("src",this.src),e.setStyles({display:"inline"})},t.src=e.url)}},_applyImageProperties:function(e){var t=this._getSelectedImageProperties(),a=e.one("."+S.IMAGEPREVIEW);if(!1===t)return a.setStyle("display","none"),void o.some(function(e){return!!e.isDefault},this);t.align&&e.one("."+S.INPUTALIGNMENT).set("value",t.align),t.customstyle&&e.one("."+S.INPUTCUSTOMSTYLE).set(
"value",t.customstyle),t.src?(e.one("."+S.INPUTURL).set("value",t.src),this._loadPreviewImage(t.src)):e.one("."+S.INPUTURL).set("value","")},_applyFablibProperties:function(e){this._setDuration(),this._setDifficulty(),this._setIntroduction(),this._setMachines(),this._setMaterials(),this._setFiles(),this._setSafety(),this._setCredits(),this._setIcons(),this._setDigitalMakingProfile()},_getSelectedImageProperties:function(){var e,t,a={src:null,alt:null,align:"",presentation:!1},i=this.editor.all("img");return(i=i&&(i=i.filter(".fablib_bannerimage")).filter(this._currentLanguageSelector))&&i.size()?(t=this._removeLegacyAlignment(i.item(0)),e=(this._selectedImage=t).getAttribute("style"),a.customstyle=e,this._getAlignmentPropeties(t,a),a.src=t.getAttribute("src"),a.presentation="presentation"===t.get("role"),a):(this._selectedImage=null,!1)},_getAlignmentPropeties:function(a,i){var n;!o.some(function(e){var t=this._getAlignmentClass(e.value);return a.hasClass(t)?(i.align=e.value,!0):(e.isDefault&&(n=e.value),!1)},this)&&n&&(i.align=n)},_urlChanged:function(){var e=this._attoform.one("."+S.INPUTURL);""!==e.get("value")&&this._loadPreviewImage(e.get("value"))},_setImage:function(){var e,t=this._attoform,a=t.one("."+S.INPUTURL).get("value"),i=this._getAlignmentClass(t.one("."+S.INPUTALIGNMENT).get("value")),n=t.one("."+S.INPUTCUSTOMSTYLE).get("value"),o=[],l=this.get("host");if(!this._updateWarning())return e=this._attoform.one("#language").get("value"),l.focus(),""!==a?(this._selectedImage?l.setSelection(l.getSelectionFromNode(this._selectedImage)):l.setSelection(this._currentSelection),o.push(i),T.Handlebars.compile(m)({url:a,customstyle:n,classlist:o.join(" "),lang:e})):void 0},_insertData:function(e){var t,a,i,n,o,l,r,s,c,d,g,p,_,u,m,h=this._attoform,v=h.one("."+S.INPUTURL).get("value"),b="",f="",y="",A="",k="",x=this.get("host");e.preventDefault(),this._updateWarning()||(x.focus(),""!==v&&(x.setSelection(this._currentSelection),t=this._setImage(),f=this._appendTitle("","duration"),a=this._appendDuration(f),f=this._appendTitle("","difficulty"),i=this._appendDifficulty(f),f=this._appendTitle("","machines"),n=this._appendMachines(f),f=this._appendTitle("","materials"),o=this._appendMaterials(f),f=this._appendTitle("","files"),l=this._appendFiles(f),f=this._appendTitle("","credits"),r=this._appendCredits(f),f=this._appendTitle("","introduction"),s=this._appendIntroduction(f),f=this._appendTitle("","safety"),c=this._appendSafety(f),f=this._appendTitle("","sdg"),d=this._appendIcons(f,C),f=this._appendTitle("","century"),g=this._appendIcons(f,I),f=this._appendTitle("","computational_thinking"),p=this._appendIcons(f,w),f=this._appendTitle("","digital_making"),_=this._appendDigitalMakingProfile(f),y=a+i+n+o+l+c+r,u="mlang_"+this._currentLanguageCode+" col-md-4 span3",k=this._prependAndAppendColumn(y,u),A=s+d+g+p+_,u="mlang_"+this._currentLanguageCode+" col-md-8 span8",b=k+this._prependAndAppendColumn(A,u),b=this._prependAndAppendRow(b),b=t+(b=this._prependAndAppendContainer(b)),b=this._prependAndAppendLanguageTags(b),m=this.editor.children,this.get("host").selectionFilterMatches(".contentwrapper",m,!1)?(T.all("#mlang_"+this._currentLanguageCode).each(function(e){e.remove(!0)},this),T.one("#fablib_contentwrapper").append(b)):(b=this._prependAndAppendContentWrapper(b),this.get("host").insertContentAtFocusPoint(b)),this.markUpdated()))},_closeDialogue:function(e){this.getDialogue({focusAfterHide:null}).hide()},_prependAndAppendContentWrapper:function(e){var t=T.Handlebars.compile('<div id="fablib_contentwrapper" class="fablib contentwrapper">'),a=t({}),i=T.Handlebars.compile(h),n=i({});return a+e+n},_prependAndAppendLanguageTags:function(e){var t=this._attoform.one("#language").get("value"),a=T.Handlebars.compile('<div id="mlang_{{lang}}"><span>{mlang {{lang}} }</span><br>'),i=a({lang:t}),n=T.Handlebars.compile("<span>{mlang}</span><br></div>"),o=n({});return i+e+o},_appendTitle:function(e,t,a){var i=e,n=this._attoform.one("#language").get("value");return t=M.util.get_string(t+"_"+n,u),i+=T.Handlebars.compile('<h3 data-category="{{category}}">{{title}}</h3>')({title:t,category:a})},_appendParagraph:function(e,t,a,i){var n=e,o=T.Handlebars.compile('<p data-category="{{category}}" data-id="{{id}}" class="mlang_{{lang}}">{{text}}</p>'),l=o({text:t,category:a,id:i,lang:this._currentLanguageCode});return n+=l},_prependAndAppendColumn:function(e,t){var a=T.Handlebars.compile('<div class="{{classes}}">'),i=a({classes:t}),n=T.Handlebars.compile("</div>"),o=n({});return i+e+o},_prependAndAppendFluidRow:function(e){var t=T.Handlebars.compile('<div class="row-fluid">'),a=t({}),i=T.Handlebars.compile(b),n=i({});return a+e+n},_prependAndAppendRow:function(e){var t=T.Handlebars.compile(v),a=t({}),i=T.Handlebars.compile(b),n=i({});return a+e+n},_prependAndAppendContainer:function(e){var t=T.Handlebars.compile('<div class="container-fluid">'),a=t({}),i=T.Handlebars.compile("</div><p><br></p>"),n=i({});return a+e+n},_appendIcons:function(e,t){var a,i,n,o,l=e,r=T.Handlebars.compile(_),s=r({});for(l+=s,a=this._attoform.one("#language").get("value"),n=i=0;n<t.length;n++)o="#checkbox"+t[n].category+t[n].index,this._attoform.one(o).get("checked")&&((i+=1)%6==1&&(l+=T.Handlebars.compile(v)({})),l+=T.Handlebars.compile(p)({url:M.util.image_url("ed/"+t[n].icon+"_"+a,u),alt:t[n].icon+"_"+a,title:"",category:"icon",id:o,lang:this._currentLanguageCode}),i%6==0&&(l+=T.Handlebars.compile(b)({})));return i%6!=0&&(l+=T.Handlebars.compile(b)({})),l+=T.Handlebars.compile(h)({})},_setIcons:function(){var e=this.editor.all('img[data-category="icon"]').filter(this._currentLanguageSelector);e&&e.size()?e.each(function(e){var t=e.getAttribute("data-id");this._attoform.one(t).set("checked",!0)},this):this._attoform.all('input[data-category="icon"]').each(function(e){e.set("checked",!1)})},_appendDigitalMakingProfile:function(e){var t,a,i,n,o,l,r=e,s=T.Handlebars.compile(_),c=s({});for(r+=c,r+=t=T.Handlebars.compile(v)({}),a=0;a<d.length;a++
)n=M.util.get_string(d[a].name,u),r+=T.Handlebars.compile('<div class="mlang_{{lang}} icon-col col-md-2 col-sm-3 col-xs-6"><p data-category="{{category}}">{{text}}</p></div>')({text:n,lang:this._currentLanguageCode});for(r+=o=T.Handlebars.compile(b)({}),r+=t,a=0;a<d.length;a++)for(l="",i=0;i<g.length;i++)if(l="radio"+d[a].category+d[a].index+g[i].category+g[i].index,this._attoform.one("#"+l).get("checked")){r+=T.Handlebars.compile(p)({url:M.util.image_url("ed/"+M.util.get_string(g[i].icon,u),u),alt:M.util.get_string(g[i].icon,u),title:this._attoform.one("#"+l).get("title"),id:l,category:"digital_making_button",lang:this._currentLanguageCode});break}return r+=o,r+=T.Handlebars.compile(h)({})},_setDigitalMakingProfile:function(){var e=this.editor.all('img[data-category="digital_making_button"]').filter(this._currentLanguageSelector);e&&e.size()?(this._attoform.all('input[data-category="digital_making_button"]').each(function(e){e.set("checked",!1);var t=e.getAttribute("id");this._attoform.one('label[for="'+t+'"]').removeClass("active")},this),e.each(function(e){var t=e.getAttribute("data-id");this._attoform.one("#"+t).set("checked",!0),this._attoform.one('label[for="'+t+'"]').addClass("active")},this)):(this._attoform.all('input[data-category="digital_making_button"]').each(function(e){e.set("checked",!1);var t=e.getAttribute("id");this._attoform.one('label[for="'+t+'"]').removeClass("active")},this),this._attoform.all('input[value="digital_making_creator"').each(function(e){e.set("checked",!0);var t=e.getAttribute("id");this._attoform.one('label[for="'+t+'"]').addClass("active")},this))},_appendDuration:function(e){var t=this._attoform.one("#language").get("value"),a=this._attoform.one("#duration").get("value"),i=M.util.get_string(a+"_"+t,u),n=this._appendParagraph(e,i,"duration",a);return n},_setDuration:function(){var e,t=this.editor.all('p[data-category="duration"]').filter(this._currentLanguageSelector);t&&t.size()?(e=t.item(0).getAttribute("data-id"),this._attoform.one('option[value="'+e+'"]').set("selected",!0)):this._attoform.one('option[value="duration1"]').set("selected",!0)},_appendDifficulty:function(e){var t=this._attoform.one("#language").get("value"),a=this._attoform.one("#difficulty").get("value"),i=M.util.get_string(a+"_"+t,u),n=this._appendParagraph(e,i,"difficulty",a);return n},_setDifficulty:function(){var e,t=this.editor.all('p[data-category="difficulty"]').filter(this._currentLanguageSelector);t&&t.size()?(e=t.item(0).getAttribute("data-id"),this._attoform.one('option[value="'+e+'"]').set("selected",!0)):this._attoform.one('option[value="difficulty1"]').set("selected",!0)},_appendMachines:function(e){var t,a,i,n,o=e,l=T.Handlebars.compile(c),r=l({});for(o+=r,t=this._attoform.one("#language").get("value"),a=0;a<s.length;a++)i="#checkbox"+s[a].category+s[a].index,this._attoform.one(i).get("checked")&&(n=this._attoform.one(i).get("value"),o+=T.Handlebars.compile(y)({item:M.util.get_string(n+"_"+t,u),category:"machines",id:i,lang:this._currentLanguageCode}));return o+=T.Handlebars.compile(f)({})},_setMachines:function(){var e=this.editor.all('li[data-category="machines"]').filter(this._currentLanguageSelector);e&&e.size()?e.each(function(e){var t=e.getAttribute("data-id");this._attoform.one(t).set("checked",!0)},this):this._attoform.all('input[name="machines"]').each(function(e){e.set("checked",!1)})},_appendMaterials:function(e){var t,a,i,n=e,o=T.Handlebars.compile(c),l=o({});for(n+=l,t=this._attoform.one("#materialsTextArea").get("value").split(";"),a=0;a<t.length;a++)""!=(i=t[a].trim())&&(n+=T.Handlebars.compile(y)({item:i,id:"",category:"materials",lang:this._currentLanguageCode}));return n+=T.Handlebars.compile(f)({})},_setMaterials:function(){var a,e=this.editor.all('li[data-category="materials"]').filter(this._currentLanguageSelector);e&&e.size()?(a="",e.each(function(e){var t=e.getHTML();a=a+t+"; "}),a.endsWith(";")&&a.slice(0,a.length-1),this._attoform.one("#materialsTextArea").set("value",a)):this._attoform.one("#materialsTextArea").set("value","")},_appendFiles:function(e){var t,a,i,n=e,o=T.Handlebars.compile(c),l=o({});for(n+=l,t=this._attoform.one("#filesTextArea").get("value").split(";"),a=0;a<t.length;a++)""!=(i=t[a].trim())&&(n+=T.Handlebars.compile(y)({item:i,id:"",category:"files",lang:this._currentLanguageCode}));return n+=T.Handlebars.compile(f)({})},_setFiles:function(){var a,e=this.editor.all('li[data-category="files"]').filter(this._currentLanguageSelector);e&&e.size()?(a="",e.each(function(e){var t=e.getHTML();a=a+t+"; "}),a.endsWith(";")&&a.slice(0,a.length-1),this._attoform.one("#filesTextArea").set("value",a)):this._attoform.one("#filesTextArea").set("value","")},_appendCredits:function(e){var t,a,i,n=e,o=T.Handlebars.compile(c),l=o({});for(n+=l,t=this._attoform.one("#creditsTextArea").get("value").split(";"),a=0;a<t.length;a++)""!=(i=t[a].trim())&&(n+=T.Handlebars.compile('<li><a class="mlang_{{lang}}" data-category="{{category}}" href={{link}}>{{text}}</a></li>')({link:i,text:i,category:"credits",id:"",lang:this._currentLanguageCode}));return n+=T.Handlebars.compile(f)({})},_setCredits:function(){var a,e=this.editor.all('a[data-category="credits"]').filter(this._currentLanguageSelector);e&&e.size()?(a="",e.each(function(e){var t=e.getAttribute("href");a=a+t+"; "}),a.endsWith(";")&&a.slice(0,a.length-1),this._attoform.one("#creditsTextArea").set("value",a)):this._attoform.one("#creditsTextArea").set("value","")},_appendIntroduction:function(e){var t=this._attoform.one("#introductionTextArea").get("value"),a=this._appendParagraph(e,t,"introduction","");return a},_setIntroduction:function(){var e,t=this.editor.all('p[data-category="introduction"]').filter(this._currentLanguageSelector);t&&t.size()?(e=t.item(0).getHTML(),this._attoform.one("#introductionTextArea").set("value",e)):this._attoform.one("#introductionTextArea").set("value","")},_appendSafety:function(e){var t,a,i,n=e,o=T.Handlebars.compile(c),l=o({});for(n+=l,t=this._attoform.one(
"#safetyTextArea").get("value").split(";"),a=0;a<t.length;a++)""!=(i=t[a].trim())&&(n+=T.Handlebars.compile(y)({item:i,category:"safety",id:"",lang:this._currentLanguageCode}));return n+=T.Handlebars.compile(f)({})},_setSafety:function(){var a,e=this.editor.all('li[data-category="safety"]').filter(this._currentLanguageSelector);e&&e.size()?(a="",e.each(function(e){var t=e.getHTML();a=a+t+"; "}),a.endsWith(";")&&a.slice(0,a.length-1),this._attoform.one("#safetyTextArea").set("value",a)):this._attoform.one("#safetyTextArea").set("value","")},_appendDigitalMaking:function(e){return e},_removeLegacyAlignment:function(a){return a.getStyle("margin")&&o.some(function(e){if(a.getStyle(e.name)!==e.value)return!1;var t=T.Node.create("<div>");return t.setStyle("margin",e.margin),a.getStyle("margin")===t.getStyle("margin")&&(a.addClass(this._getAlignmentClass(e.value)),a.setStyle(e.name,null),a.setStyle("margin",null),!0)},this),a},_getAlignmentClass:function(e){return S.ALIGNSETTINGS+"_"+e},_updateWarning:function(){return!1}})},"@VERSION@",{requires:["moodle-editor_atto-plugin"]});